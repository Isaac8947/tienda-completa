<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final - B√∫squeda con Im√°genes Reales</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .search-container { margin-bottom: 20px; }
        .search-input { padding: 15px; width: 100%; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; }
        .search-input:focus { outline: none; border-color: #007bff; }
        .search-results { border: 1px solid #ddd; border-radius: 8px; max-height: 500px; overflow-y: auto; background: white; }
        .product-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; transition: background 0.2s; }
        .product-item:hover { background-color: #f8f9fa; }
        .product-item:last-child { border-bottom: none; }
        .product-image { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin-right: 15px; border: 1px solid #ddd; background: #f8f9fa; }
        .product-info { flex: 1; }
        .product-info h4 { margin: 0 0 5px 0; font-size: 16px; color: #333; }
        .product-info p { margin: 0 0 8px 0; font-size: 14px; color: #666; }
        .product-price { color: #e74c3c; font-weight: bold; font-size: 16px; }
        .original-price { text-decoration: line-through; color: #999; margin-left: 8px; font-size: 14px; }
        .no-results { padding: 40px; text-align: center; color: #666; }
        .loading { padding: 40px; text-align: center; color: #007bff; }
        .status-indicator { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .image-placeholder { width: 80px; height: 80px; background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%); background-size: 16px 16px; background-position: 0 0, 0 8px, 8px -8px, -8px 0px; border-radius: 8px; margin-right: 15px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Final - B√∫squeda con Im√°genes Reales</h1>
        
        <div class="status-indicator status-info">
            <strong>Estado:</strong> Productos con im√°genes reales corregidas ‚úÖ
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Buscar productos (ej: eiggis, samsung, projector...)">
        </div>
        
        <div class="search-results" id="search-results" style="display: none;">
            <!-- Results will appear here -->
        </div>
        
        <div class="status-indicator status-success" style="display: none;" id="success-indicator">
            <strong>‚úÖ B√∫squeda exitosa:</strong> <span id="results-count"></span> productos encontrados
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        const successIndicator = document.getElementById('success-indicator');
        const resultsCount = document.getElementById('results-count');
        
        let searchTimeout;
        
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length < 2) {
                searchResults.style.display = 'none';
                successIndicator.style.display = 'none';
                return;
            }
            
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        });
        
        function performSearch(query) {
            // Show loading
            searchResults.innerHTML = '<div class="loading">üîÑ Buscando productos...</div>';
            searchResults.style.display = 'block';
            successIndicator.style.display = 'none';
            
            fetch(`api/search.php?q=${encodeURIComponent(query)}&limit=10`)
                .then(response => response.json())
                .then(data => {
                    console.log('Search API Response:', data);
                    displayResults(data, query);
                })
                .catch(error => {
                    console.error('Search error:', error);
                    searchResults.innerHTML = '<div class="no-results">‚ùå Error al realizar la b√∫squeda</div>';
                });
        }
        
        function displayResults(data, query) {
            if (!data.products || data.products.length === 0) {
                searchResults.innerHTML = '<div class="no-results">üîç No se encontraron productos para \"' + query + '\"</div>';
                return;
            }
            
            let html = '';
            data.products.forEach((product, index) => {
                const price = product.sale_price && product.sale_price < product.price ? product.sale_price : product.price;
                const originalPrice = product.sale_price && product.sale_price < product.price ? product.price : null;
                
                html += `
                    <div class="product-item">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                             <div class="image-placeholder" style="display: none;">Sin imagen</div>` :
                            `<div class="image-placeholder">Sin imagen</div>`
                        }
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <p>${product.brand_name || 'Sin marca'} ${product.brand_name && product.category_name ? '‚Ä¢' : ''} ${product.category_name || 'Sin categor√≠a'}</p>
                            <div class="product-price">
                                $${Number(price).toLocaleString()}
                                ${originalPrice ? `<span class="original-price">$${Number(originalPrice).toLocaleString()}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            searchResults.innerHTML = html;
            
            // Show success indicator
            resultsCount.textContent = data.products.length;
            successIndicator.style.display = 'block';
            
            // Log images status
            console.log('Images status:');
            data.products.forEach((product, index) => {
                console.log(`${index + 1}. ${product.name}: ${product.image || 'No image'}`);
            });
        }
        
        // Auto-search for testing
        setTimeout(() => {
            searchInput.value = 'eiggis';
            performSearch('eiggis');
        }, 1000);
    </script>
</body>
</html>